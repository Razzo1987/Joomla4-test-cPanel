(a=>{'use strict';const c=new RegExp(/^#([a-z0-9]{1,2})([a-z0-9]{1,2})([a-z0-9]{1,2})$/i),d=new RegExp(/^rgba?\(([0-9]+)[\D]+([0-9]+)[\D]+([0-9]+)(?:[\D]+([0-9](?:.\d+)?))?\)$/i),e=new RegExp(/^hsla?\(([0-9]+)[\D]+([0-9]+)[\D]+([0-9]+)[\D]+([0-9](?:.\d+)?)?\)$/i),f=new RegExp(/^(([0-1])|(0\\.[0-9]+)|([0-9]{1,2})|(100))$/),g=new RegExp(/^[0-9]{1,3}$/);class h{constructor(a){this.messageSpan=a.querySelector(".form-control-feedback"),this.mainInput=a.querySelector(".color-input"),this.input=a.querySelector("#slider-input"),this.sliders=a.querySelectorAll(".color-slider"),this.hueSlider=a.querySelector("#hue-slider"),this.saturationSlider=a.querySelector("#saturation-slider"),this.lightSlider=a.querySelector("#light-slider"),this.alphaSlider=a.querySelector("#alpha-slider"),this.color=a.dataset.color||"",this.default=a.dataset.default||"",this.format=this.input.dataset.format||"hex",this.saveFormat=this.mainInput.dataset.format||"hex",this.preview="true"===a.dataset.preview,this.setAlpha="hsla"===this.format||"rgba"===this.format,this.hue=360,this.saturation=1,this.light=1,this.alpha=1,this.defaultHsl=[this.hue,this.saturation,this.light,this.alpha],this.setInitValue(),this.setBackground(),this.preview?this.setInputPattern():this.input.classList.add("hidden"),this.mainInput.classList.add("hidden"),Array.prototype.forEach.call(this.sliders,a=>{a.addEventListener("change",()=>this.updateValue(a))}),this.input.addEventListener("change",()=>this.changeInput(this.input))}updateValue(a){this.showError("");const b=this.getSliderValueAsHsl(a.value,a.dataset.type),c=this.hslToRgb(b);[this.hue,this.saturation,this.light,this.alpha]=b,this.input.style.border=`2px solid ${this.getRgbString(c)}`,this.setSliderValues(b,a.dataset.type),this.setInputValue(b),this.setBackground(a)}changeInput(a){let b=[this.hue,this.saturation,this.light,this.alpha];if(!a.value)return this.mainInput.value="",void this.showError("");if(!this.checkValue(a.value))this.showError("JFIELD_COLOR_ERROR_WRONG_FORMAT"),this.setInputValue(this.defaultHsl);else{switch(this.showError(""),this.format){case"hue":b[0]=a.value,this.hue=a.value;break;case"saturation":b[1]=a.value,this.saturation=a.value;break;case"light":b[2]=a.value,this.light=a.value;break;case"alpha":b[3]=a.value,this.alpha=a.value;break;default:b=this.getHsl(a.value);}this.setSliderValues(b),this.setInputValue(b,!0)}}checkValue(a,b){const h=b||this.format;return"hue"===h?360>=a&&g.test(a):"saturation"===h||"light"===h||"alpha"===h?f.test(a):"hsl"===h||"hsla"===h?e.test(a):"hex"===h?c.test(a):!("rgb"!==h&&"rgba"!==h)&&d.test(a)}setInputPattern(){let a;switch(this.format){case"hue":a=g.source.slice(1,-1);break;case"saturation":case"light":case"alpha":a=f.source.slice(1,-1);break;case"hsl":case"hsla":a=e.source.slice(1,-1);break;case"rgb":a=d.source.slice(1,-1);break;case"hex":default:a=c.source.slice(1,-1);}this.input.setAttribute("pattern",a)}setBackground(a){Array.prototype.forEach.call(this.sliders,b=>{if(a===b)return;let c=[],d=100;if(c.push(this.getSliderValueAsRgb(0,b.dataset.type)),"hue"===b.dataset.type){const a=Math.floor(18);d=360;for(let d=0;360>=d;d+=a)c.push(this.getSliderValueAsRgb(d,b.dataset.type))}else for(let a=0;100>=a;a+=10)c.push(this.getSliderValueAsRgb(a,b.dataset.type));c.push(this.getSliderValueAsRgb(d,b.dataset.type)),c=c.map(a=>this.getRgbString(a)),b.style.background=`linear-gradient(90deg, ${c.join(",")})`,b.style.webkitAppearance="none"})}setInitValue(){const a=window.getComputedStyle(this.input).getPropertyValue(this.default);if(this.default=a||this.default,""===this.color||"undefined"==typeof this.color)return this.input.value="",void(this.mainInput.value="");const b=this.checkValue(this.color,this.saveFormat)?this.color:this.default;if(!b)return void this.showError("JFIELD_COLOR_ERROR_NO_COLOUR");let c=[];/^[0-9]+$/.test(b)?(c=this.default&&this.getHsl(this.default),"hue"===this.format&&(c[0]=b),"saturation"===this.format&&(c[1]=1<b?b/100:b),"light"===this.format&&(c[2]=1<b?b/100:b),"alpha"===this.format&&(c[3]=1<b?b/100:b)):c=this.getHsl(b),[this.hue,this.saturation,this.light]=c,this.alpha=c[4]||this.alpha,this.defaultHsl=this.default?this.getHsl(this.default):c,this.setSliderValues(c),this.setInputValue(c),this.input.style.border=`2px solid ${this.getRgbString(this.hslToRgb(c))}`}showError(a){this.messageSpan.innerText=a?Joomla.Text._(a):""}getHsl(a){let b=[];if(Array.isArray(a))b=a;else if(c.test(a))b=this.hexToHsl(a);else if(d.test(a))b=this.rgbToHsl(a);else if(e.test(a)){const c=a.match(e);b=[c[1],c[2],c[3],c[4]]}else return this.showError("JFIELD_COLOR_ERROR_CONVERT_HSL"),this.defaultHsl;let f;for(f=1;f<b.length;f+=1)b[f]=1<b[f]?b[f]/100:b[f];return b}getSliderValueAsHsl(b,c){let d=this.hue,e=this.saturation,f=this.light,g=this.alpha;switch(c){case"alpha":g=b;break;case"saturation":e=b;break;case"light":f=b;break;case"hue":default:d=b;}return 1<f&&(f/=100),1<e&&(e/=100),1<g&&(g/=100),[d,e,f,g]}getSliderValueAsRgb(a,b){return this.hslToRgb(this.getSliderValueAsHsl(a,b))}setSliderValues([b,c,d,e],a){this.hueSlider&&"hue"!==a&&(this.hueSlider.value=Math.round(b)),this.saturationSlider&&"saturation"!==a&&(this.saturationSlider.value=Math.round(100*c)),this.lightSlider&&"light"!==a&&(this.lightSlider.value=Math.round(100*d)),e&&this.alphaSlider&&"alpha"!==a&&(this.alphaSlider.value=Math.round(100*e))}setInputValue(a,b){const c=[this.mainInput];b||c.push(this.input),c.forEach(b=>{let c;switch(b.dataset.format){case"hsl":c=this.getHslString(a);break;case"hsla":c=this.getHslString(a,!0);break;case"rgb":c=this.getRgbString(this.hslToRgb(a));break;case"rgba":c=this.getRgbString(this.hslToRgb(a),!0);break;case"hex":c=this.rgbToHex(this.hslToRgb(a));break;case"alpha":c=Math.round(100*a[3]);break;case"saturation":c=Math.round(100*a[1]);break;case"light":c=Math.round(100*a[2]);break;case"hue":default:c=Math.round(a[0]);}b.value=c})}getRgbString([c,d,e,b],a){if(a||this.setAlpha){const a="undefined"==typeof b?this.alpha:b;return`rgba(${c}, ${d}, ${e}, ${a})`}return`rgb(${c}, ${d}, ${e})`}getHslString(b,c){let[d,e,f,g]=b;return e*=100,f*=100,[d,e,f]=[d,e,f].map(a=>Math.round(a)),c||this.setAlpha?(g=g||this.alpha,`hsla(${d}, ${e}%, ${f}%, ${g})`):`hsl(${d}, ${e}%, ${f}%)`}rgbToHex(a){let c=a[0].toString(16).toUpperCase(),d=a[1].toString(16).toUpperCase(),e=a[2].toString(16).toUpperCase();return c=1===c.length?`${c}${c}`:c,d=1===d.length?`${d}${d}`:d,e=1===e.length?`${e}${e}`:e,`#${c}${d}${e}`}rgbToHsl(c){let e=c;if("string"==typeof c){const a=c.match(d);e=[a[1],a[2],a[3],a[4]]}const[f,i,g]=e.map(a=>1<a?a/255:a),b=Math.max(f,i,g),j=Math.min(f,i,g),k=(b+j)/2,l=b-j;let m=0,n=0,o=e[3]||c[3]||this.alpha;if(b!==j)switch(n=0===b?b:1===j?j:(b-k)/Math.min(k,1-k),b){case f:m=60*(i-g)/l;break;case i:m=60*(2+(g-f)/l);break;case g:default:m=60*(4+(f-i)/l);}return m=0>m?m+360:m,o=1<o?o/100:o,[m,n,k,o]}hexToHsl(a){const d=a.match(c),e=d[1],f=d[2],g=d[3],b=[parseInt(e,16),parseInt(f,16),parseInt(g,16)];return this.rgbToHsl(b)}hslToRgb([d,e,f,h]){let i=1,j=1,k=1;const m=1<e?e/100:e,n=1<f?f/100:f,l=1<h?h/100:h;if(0>d||360<d||0>m||1<m||0>n||1<n)return this.showError("JFIELD_COLOR_ERROR_CONVERT_HSL"),this.hslToRgb(this.defaultHsl);const a=(1-Math.abs(2*n-1))*m,c=a*(1-Math.abs(d/60%2-1));if(0<=d&&60>d)[i,j,k]=[a,c,0];else if(60<=d&&120>d)[i,j,k]=[c,a,0];else if(120<=d&&180>d)[i,j,k]=[0,a,c];else if(180<=d&&240>d)[i,j,k]=[0,c,a];else if(240<=d&&300>d)[i,j,k]=[c,0,a];else if(300<=d&&360>=d)[i,j,k]=[a,0,c];else return this.showError("JFIELD_COLOR_ERROR_CONVERT_HUE"),this.hslToRgb(this.defaultHsl);const o=[i,j,k].map(b=>Math.round(255*(b+(n-a/2))));return o.push(l),o}}a.addEventListener("DOMContentLoaded",()=>{const b=a.querySelectorAll(".color-slider-wrapper");b&&Array.prototype.forEach.call(b,a=>{new h(a)})})})(document);