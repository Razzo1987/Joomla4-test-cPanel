"use strict";window.customElements.define("joomla-field-permissions",class extends HTMLElement{constructor(){if(super(),!Joomla)throw new Error("Joomla API is not properly initiated");if(!this.getAttribute("data-uri"))throw new Error("No valid url for validation");this.query=window.location.search.substring(1),this.buttons="",this.buttonDataSelector="data-onchange-task",this.onDropdownChange=this.onDropdownChange.bind(this),this.getUrlParam=this.getUrlParam.bind(this),this.component=this.getUrlParam("component"),this.extension=this.getUrlParam("extension"),this.option=this.getUrlParam("option"),this.view=this.getUrlParam("view"),this.asset="not",this.context=""}connectedCallback(){this.buttons=[].slice.call(document.querySelectorAll(`[${this.buttonDataSelector}]`)),this.buttons&&this.buttons.forEach(a=>{a.addEventListener("change",this.onDropdownChange)})}disconnectedCallback(){this.buttons&&this.buttons.forEach(a=>{a.removeEventListener("change",this.onDropdownChange)})}onDropdownChange(a){a.preventDefault();const b=a.target.getAttribute(this.buttonDataSelector);"permissions.apply"===b&&this.sendPermissions(a)}sendPermissions(a){const{target:b}=a,c=document.getElementById(`icon_${b.id}`);c.removeAttribute("class"),c.setAttribute("class","joomla-icon joomla-field-permissions__spinner");const{value:d}=b;document.getElementById("jform_context")&&(this.context=document.getElementById("jform_context").value,[this.context]=this.context.split(".")),"com_config"!==this.option||this.component||this.extension?this.extension||"component"!==this.view?this.context?(this.asset="group"===this.view?`${this.context}.fieldgroup.${this.getUrlParam("id")}`:`${this.context}.field.{this.getUrlParam('id')}`,this.title=document.getElementById("jform_title").value):this.extension&&this.view?(this.asset=`${this.extension}.${this.view}.${this.getUrlParam("id")}`,this.title=document.getElementById("jform_title").value):!this.extension&&this.view&&(this.asset=`${this.option}.${this.view}.${this.getUrlParam("id")}`,this.title=document.getElementById("jform_title").value):this.asset=this.component:this.asset="root.1";const e=b.id.replace("jform_rules_",""),f=e.lastIndexOf("_"),g={comp:this.asset,action:e.substring(0,f),rule:e.substring(f+1),value:d,title:this.title};Joomla.removeMessages(),Joomla.request({url:this.getAttribute("data-uri"),method:"POST",data:JSON.stringify(g),perform:!0,headers:{"Content-Type":"application/json"},onSuccess:a=>{let d;try{d=JSON.parse(a)}catch(a){console.log(a)}if(c.removeAttribute("class"),d.data&&d.data.result){c.setAttribute("class","joomla-icon joomla-field-permissions__allowed");const a=b.parentNode.parentNode.nextElementSibling.querySelector("span");a.removeAttribute("class"),a.setAttribute("class",d.data.class),a.innerHTML=d.data.text}"object"==typeof d.messages&&null!==d.messages&&(Joomla.renderMessages(d.messages),d.data&&d.data.result?c.setAttribute("class","joomla-icon joomla-field-permissions__allowed"):c.setAttribute("class","joomla-icon joomla-field-permissions__denied"))},onError:a=>{c.removeAttribute("style"),Joomla.renderMessages(Joomla.ajaxErrorsMessages(a,a.statusText)),c.setAttribute("class","joomla-icon joomla-field-permissions__denied")}})}getUrlParam(a){const b=this.query.split("&");let c=0;for(c;c<b.length;c+=1){const d=b[c].split("=");if(d[0]===a)return d[1]}return!1}});